<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Govinda's Prasadam | Premium Experience</title>
    
    <!-- GOOGLE FONTS & ICONS -->
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- RAZORPAY SDK -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <!-- MANIFEST FOR PWA -->
    <link rel="manifest" href="/manifest.json">

    <style>
        :root {
            --brand: #FF6D00;       /* Saffron Orange */
            --brand-dark: #E65100;
            --brand-light: #FFF3E0;
            --bg-body: #F4F7F9;     /* Slight bluish tint */
            --white: #ffffff;
            --text-main: #0F172A;   /* Dark slate */
            --text-light: #64748B;
            --success: #10B981;
            --error: #EF4444;
            --warning: #F59E0B;     /* Review Star Color */
            --nav-height: 75px;
            --radius-box: 18px;
            --max-width: 1280px;    /* Increased for Desktop */
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Manrope', sans-serif; }
        
        body { 
            background: var(--bg-body); 
            color: var(--text-main); 
            padding-bottom: calc(var(--nav-height) + 40px); 
            user-select: none; 
            -webkit-font-smoothing: antialiased; 
            min-height: 100vh;
        }

        a { text-decoration: none; color: inherit; }
        
        /* SCROLLBAR STYLING FOR DESKTOP */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* --- LAYOUT UTILITIES & RESPONSIVENESS --- */
        .app-container {
            max-width: var(--max-width);
            margin: 0 auto;
            background: #fff;
            min-height: 100vh;
            box-shadow: 0 0 50px rgba(0,0,0,0.05);
            position: relative;
            overflow-x: hidden;
        }
        
        /* DESKTOP ENHANCEMENTS */
        @media (min-width: 992px) {
            body { padding-bottom: 0; background: #E0E7FF; }
            .app-container { 
                margin: 20px auto; 
                border-radius: 24px; 
                min-height: 95vh;
                overflow: hidden; /* Prevent body scroll overlap */
            }
            .app-header {
                position: relative !important;
                background: white !important;
                padding: 15px 40px !important;
                border-bottom: 1px solid #f1f5f9;
            }
            
            /* Nav stays at bottom for Desktop too (Premium Dock Style) */
            .btm-nav {
                max-width: 600px !important;
                margin: 0 auto !important;
                bottom: 20px !important;
                border-radius: 50px !important;
                box-shadow: 0 10px 40px rgba(0,0,0,0.15) !important;
                border: 1px solid rgba(255,255,255,0.8) !important;
            }
            
            .nav-btn {
                flex-direction: row !important;
                gap: 8px !important;
            }
        }

        .hide { display: none !important; }
        .flex-between { display: flex; justify-content: space-between; align-items: center; }
        .center { display: flex; justify-content: center; align-items: center; }
        .ellipsis { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; white-space: normal; }

        /* --- AUTH SCREEN --- */
        #auth-overlay { position: fixed; inset: 0; background: rgba(255,255,255,0.98); z-index: 3000; padding: 30px; display: flex; flex-direction: column; justify-content: center; text-align: center; overflow-y: auto; backdrop-filter: blur(10px); }
        .auth-content { max-width: 400px; margin: 0 auto; width: 100%; padding-top: 20px; animation: fadeInUp 0.4s ease-out; } 
        .auth-close { position: absolute; top: 20px; right: 20px; font-size: 1.5rem; color: #333; cursor: pointer; background: #eee; width: 40px; height: 40px; border-radius: 50%; display: grid; place-items: center; transition: 0.2s; }
        .auth-close:active { transform: scale(0.9); }
        
        .logo-ring { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 20px; box-shadow: var(--shadow-lg); overflow: hidden; border: 3px solid var(--white); }
        .logo-ring img { width: 100%; height: 100%; object-fit: cover; }
        
        .auth-inp { width: 100%; padding: 18px; border: 1px solid #E2E8F0; border-radius: var(--radius-box); margin-bottom: 15px; font-size: 1rem; outline: none; background: #F8FAFC; transition: 0.3s; font-weight: 500; }
        .auth-inp:focus { border-color: var(--brand); background: white; box-shadow: 0 0 0 4px rgba(255, 109, 0, 0.1); }
        
        .btn { width: 100%; padding: 18px; border: none; border-radius: var(--radius-box); font-weight: 700; font-size: 1rem; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; position: relative; }
        .btn:active { transform: scale(0.97); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: none; filter: grayscale(1); }
        .btn-brand { background: var(--brand); color: white; box-shadow: 0 8px 20px rgba(255, 109, 0, 0.25); background: linear-gradient(135deg, var(--brand), var(--brand-dark)); }
        .btn-google { background: white; color: #333; border: 1px solid #E2E8F0; box-shadow: var(--shadow-sm); margin-bottom: 15px; font-weight: 600; }
        .btn-sec { background: transparent; color: #64748B; margin-top: 5px; font-size: 0.9rem; font-weight: 600; }
        
        .divider { display: flex; align-items: center; text-align: center; color: #94A3B8; margin: 25px 0; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .divider::before, .divider::after { content: ''; flex: 1; border-bottom: 1px solid #E2E8F0; }
        .divider:not(:empty)::before { margin-right: 1em; }
        .divider:not(:empty)::after { margin-left: 1em; }

        /* --- APP HEADER --- */
        .app-header { 
            background: rgba(255,255,255,0.95); 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            padding: 12px 20px; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
            box-shadow: var(--shadow-sm); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin: 0 auto; 
            width: 100%; 
            transition: 0.3s;
        }

        /* BRANDING HEADER STYLES */
        .brand-box { display: flex; align-items: center; gap: 12px; }
        .brand-logo { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid var(--brand); box-shadow: 0 4px 10px rgba(255,109,0,0.2); }
        .brand-info { display: flex; flex-direction: column; }
        .brand-name { font-weight: 800; font-size: 1.1rem; color: var(--text-main); line-height: 1.1; letter-spacing: -0.5px; }
        .brand-tag { font-size: 0.75rem; color: var(--brand); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }

        .loc-row { display: flex; align-items: center; gap: 8px; cursor: pointer; background: #F1F5F9; padding: 6px 12px; border-radius: 30px; transition: 0.2s; }
        .loc-row:active { transform: scale(0.95); }
        .loc-icon-bg { font-size: 0.9rem; color: var(--brand-dark); }
        .loc-txt { font-size: 0.8rem; color: var(--text-main); max-width: 120px; font-weight: 700; }

        /* --- BANNER / SLIDER --- */
        .banner-wrapper {
            position: relative; border-radius: 24px; overflow: hidden;
            box-shadow: var(--shadow-md); margin: 20px 15px 15px;
            max-width: 1200px; background: #eee; transform: translateZ(0);
        }
        @media(min-width: 768px) { .banner-wrapper { margin: 25px 25px 15px; } }

        .slider-box { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .slider-box::-webkit-scrollbar { display: none; }
        .slide { min-width: 100%; aspect-ratio: 2.2 / 1; background-size: cover; background-position: center; background-repeat: no-repeat; scroll-snap-align: start; flex-shrink: 0; }
        @media(min-width: 1024px) { .slide { aspect-ratio: 3.5 / 1; } }

        .slider-dots { position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; z-index: 5; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 20px; backdrop-filter: blur(4px); }
        .dot { width: 6px; height: 6px; background: rgba(255,255,255,0.6); border-radius: 50%; transition: all 0.3s ease; }
        .dot.active { background: #fff; width: 18px; border-radius: 12px; }

        /* --- CATEGORIES --- */
        .cat-scroll { display: flex; overflow-x: auto; gap: 12px; padding: 10px 15px 25px; scroll-behavior: smooth; }
        @media(min-width: 1024px) { .cat-scroll { padding: 10px 25px 25px; justify-content: center; } }
        .cat-scroll::-webkit-scrollbar { display: none; }
        .cat-item { display: flex; align-items: center; gap: 8px; padding: 8px 16px 8px 8px; background: #fff; border: 1px solid #F1F5F9; border-radius: 50px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--shadow-sm); flex-shrink: 0; }
        .cat-img { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; background: #f0f0f0; }
        .cat-name { font-size: 0.9rem; font-weight: 700; color: var(--text-light); white-space: nowrap; }
        .cat-item.active { background: var(--brand); border-color: var(--brand); box-shadow: 0 8px 20px rgba(255, 109, 0, 0.3); transform: translateY(-2px); }
        .cat-item.active .cat-name { color: white; }
        .cat-item.active .cat-img { border: 2px solid white; }

        /* --- PRODUCT CARDS --- */
        .prod-grid { padding: 0 15px; display: grid; gap: 18px; grid-template-columns: repeat(1, 1fr); }
        @media (min-width: 600px) { .prod-grid { grid-template-columns: repeat(2, 1fr); padding: 0 25px; } }
        @media (min-width: 900px) { .prod-grid { grid-template-columns: repeat(3, 1fr); padding: 0 40px; } }
        @media (min-width: 1200px) { .prod-grid { grid-template-columns: repeat(4, 1fr); } }

        .prod-card { background: white; border-radius: 20px; padding: 16px; display: grid; grid-template-columns: 1fr 110px; gap: 15px; border: 1px solid #F1F5F9; box-shadow: var(--shadow-sm); min-height: 160px; transition: 0.3s; cursor: pointer; overflow: hidden; position: relative; }
        @media (min-width: 900px) {
            .prod-card { grid-template-columns: 1fr; grid-template-rows: 150px 1fr; gap: 10px; }
            .prod-img-wrapper { width: 100% !important; height: 100% !important; border-radius: 12px; }
            .prod-card .prod-info { order: 2; }
            .prod-card .prod-img-wrapper { order: 1; }
            .add-btn { bottom: 10px; top: auto; right: 10px; left: auto; transform: none; width: 100px; }
            .sold-out-badge { top: 40%; }
        }

        .prod-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); }
        .prod-card:active { transform: scale(0.98); }
        
        .prod-info { display: flex; flex-direction: column; justify-content: space-between; padding: 2px 0; min-width: 0; position: relative; }
        .veg-tag { border: 1px solid var(--success); width: 16px; height: 16px; padding: 2px; border-radius: 4px; display: flex; justify-content: center; align-items: center; margin-bottom: 5px; }
        .veg-dot { background: var(--success); width: 8px; height: 8px; border-radius: 50%; }
        .unit-badge { font-size: 0.7rem; background: #F3E5F5; color: #7B1FA2; padding: 3px 8px; border-radius: 6px; font-weight: 700; display: inline-block; margin-left: 6px; vertical-align: middle; white-space: nowrap; letter-spacing: 0.3px; }
        
        .rating-badge { display: flex; align-items: center; gap: 4px; font-size: 0.75rem; color: var(--text-light); font-weight: 600; margin-top: 5px; }
        .star-icon { color: var(--warning); font-size: 0.8rem; }
        
        .prod-img-wrapper { position: relative; width: 110px; height: 110px; flex-shrink: 0; border-radius: 16px; overflow: hidden; background: #f9f9f9; box-shadow: inset 0 0 10px rgba(0,0,0,0.03); }
        .prod-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .prod-card:hover .prod-img { transform: scale(1.1); }
        
        .add-btn { position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); background: white; color: var(--success); border: 1px solid #E0E0E0; font-weight: 800; padding: 0; width: 90px; height: 36px; display: grid; place-items: center; border-radius: 10px; font-size: 0.85rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15); cursor: pointer; z-index: 5; transition: 0.2s; top: 85px;}
        .qty-box { display: flex; align-items: center; justify-content: space-between; width: 100%; height: 100%; padding: 0 10px; }
        .prod-card.out-of-stock { opacity: 0.6; pointer-events: none; filter: grayscale(1); }
        .sold-out-badge { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--error); color: white; padding: 5px 10px; border-radius: 6px; font-size: 0.7rem; font-weight: 800; white-space: nowrap; z-index: 6; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4); }

        /* --- PRODUCT DETAIL --- */
        #view-product { background: white; min-height: 100vh; position: relative; padding-bottom: 90px; width: 100%; }
        .pd-header { position: absolute; top: 0; left: 0; width: 100%; z-index: 10; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; pointer-events: none; }
        @media(min-width: 992px) { 
            .pd-header { position: sticky; background: rgba(255,255,255,0.95); } 
            #view-product { max-width: 900px; margin: 0 auto; min-height: auto; border-radius: 20px; box-shadow: 0 0 200px rgba(0,0,0,0.05); }
        }

        .pd-back-btn { background: rgba(255,255,255,0.9); width: 44px; height: 44px; border-radius: 50%; display: grid; place-items: center; font-size: 1.1rem; color: #333; cursor: pointer; pointer-events: auto; box-shadow: 0 5px 20px rgba(0,0,0,0.1); backdrop-filter: blur(8px); }
        .pd-gallery { width: 100%; height: 45vh; max-height: 500px; background: #f5f5f5; overflow-x: auto; display: flex; scroll-snap-type: x mandatory; }
        .pd-gallery::-webkit-scrollbar { display: none; }
        .pd-slide { min-width: 100%; height: 100%; object-fit: cover; scroll-snap-align: center; }
        
        .pd-content { padding: 35px 25px; border-radius: 35px 35px 0 0; background: white; margin-top: -40px; position: relative; z-index: 5; box-shadow: 0 -10px 40px rgba(0,0,0,0.08); min-height: 60vh; }
        
        .desktop-pd-split { display: block; }
        @media(min-width: 992px) {
            .pd-content { margin-top: 0; border-radius: 0; box-shadow: none; min-height: auto; }
            .desktop-pd-split { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; padding: 40px; }
            .pd-gallery { height: 100%; border-radius: 20px; max-height: 400px; }
            .pd-mobile-top { display: none; }
        }

        .pd-title { font-size: 1.6rem; font-weight: 800; color: #1E293B; margin-bottom: 8px; line-height: 1.3; letter-spacing: -0.5px; }
        .pd-price { font-size: 1.8rem; font-weight: 800; color: var(--brand); margin: 15px 0; display: flex; align-items: center; gap: 10px; }
        .pd-desc { font-size: 1rem; line-height: 1.7; color: #475569; margin-bottom: 30px; }
        .pd-unit { background: #FFF3E0; color: var(--brand-dark); padding: 6px 14px; border-radius: 8px; font-size: 0.9rem; font-weight: 700; margin-top: 5px; display: inline-block; }
        .pd-footer { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px 20px; box-shadow: 0 -5px 30px rgba(0,0,0,0.08); display: flex; align-items: center; justify-content: space-between; z-index: 20; max-width: var(--max-width); margin: 0 auto; border-top: 1px solid #f1f1f1; }
        
        .related-box { padding: 10px 0; border-top: 1px solid #f1f1f1; margin-top: 30px; }
        .related-title { font-size: 1.2rem; font-weight: 800; margin-bottom: 15px; color: #333; padding-left: 5px; }
        .related-scroll { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 15px; scroll-behavior: smooth; }
        .related-scroll::-webkit-scrollbar { display: none; }
        .rel-card { min-width: 160px; width: 160px; background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 10px; cursor: pointer; transition: 0.2s; flex-shrink: 0; }
        .rel-card:hover { border-color: var(--brand); box-shadow: 0 5px 15px rgba(255,109,0,0.1); }
        .rel-img { width: 100%; height: 100px; border-radius: 8px; object-fit: cover; margin-bottom: 8px; }
        .rel-name { font-size: 0.85rem; font-weight: 700; margin-bottom: 4px; line-height: 1.3; height: 36px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .rel-price { font-size: 0.9rem; font-weight: 800; color: var(--brand); }

        /* --- REVIEWS SECTION STYLES --- */
        .reviews-section { margin-top: 30px; border-top: 1px solid #f1f1f1; padding-top: 25px; }
        .rev-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .rev-title { font-size: 1.2rem; font-weight: 800; color: #333; }
        .rev-add-btn { font-size: 0.85rem; font-weight: 700; color: var(--brand); cursor: pointer; border: 1px solid var(--brand); padding: 8px 16px; border-radius: 50px; transition: 0.2s; background: #fff; display: flex; align-items: center; gap: 6px; }
        .rev-add-btn:hover { background: var(--brand); color: white; }
        
        .review-card { background: #F8FAFC; border-radius: 16px; padding: 16px; margin-bottom: 15px; border: 1px solid #F1F5F9; position: relative; }
        .review-card.verified-user { border-left: 4px solid var(--success); }
        .rc-top { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .rc-user { display: flex; gap: 10px; align-items: center; }
        .rc-avatar { width: 36px; height: 36px; background: #E2E8F0; border-radius: 50%; display: grid; place-items: center; font-weight: 700; color: #64748B; font-size: 0.9rem; }
        .rc-meta { display: flex; flex-direction: column; }
        .rc-name { font-weight: 700; font-size: 0.9rem; color: #1E293B; display: flex; align-items: center; gap: 6px; }
        .verified-badge { font-size: 0.7rem; background: #E8F5E9; color: var(--success); padding: 2px 6px; border-radius: 4px; font-weight: 800; }
        .rc-date { font-size: 0.75rem; color: #94A3B8; }
        .rc-stars { color: var(--warning); font-size: 0.8rem; letter-spacing: 1px; }
        .rc-body { font-size: 0.9rem; color: #475569; line-height: 1.5; }
        .rev-empty { text-align: center; color: #94A3B8; padding: 20px; font-size: 0.9rem; background: #F8FAFC; border-radius: 12px; margin-bottom: 15px; }

        /* STAR INPUT FOR MODAL */
        .star-input-group { display: flex; gap: 8px; justify-content: center; margin: 20px 0; direction: rtl; }
        .star-input-group input { display: none; }
        .star-input-group label { font-size: 2rem; color: #E2E8F0; cursor: pointer; transition: 0.2s; }
        .star-input-group input:checked ~ label, .star-input-group label:hover, .star-input-group label:hover ~ label { color: var(--warning); }

        /* --- CART & BILLING --- */
        .cart-container-web { max-width: 800px; margin: 0 auto; }
        .cart-empty-state { text-align: center; padding: 80px 20px; }
        .cart-empty-state img { width: 180px; opacity: 0.7; margin-bottom: 25px; filter: grayscale(1); mix-blend-mode: multiply; }
        .bill-sec { background: white; padding: 25px 20px; border-radius: 25px; margin-top: 15px; box-shadow: var(--shadow-sm); border: 1px solid #f1f5f9; }
        .bill-row { display: flex; justify-content: space-between; margin-bottom: 14px; font-size: 0.95rem; font-weight: 600; color: #475569; }
        .bill-total { border-top: 2px dashed #eee; padding-top: 18px; margin-top: 15px; font-weight: 800; font-size: 1.3rem; display: flex; justify-content: space-between; align-items: center; color: #1E293B; }
        
        .coupon-box-applied { background: #F0FDF4; border: 1px solid #BBF7D0; padding: 12px 15px; border-radius: 14px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; animation: fadeInUp 0.3s ease; }
        .coupon-code-tag { font-family: monospace; font-weight: 700; color: #15803d; letter-spacing: 0.5px; background: white; padding: 4px 8px; border-radius: 6px; border: 1px dashed #15803d; }
        .coupon-remove-btn { color: #DC2626; cursor: pointer; padding: 5px; font-size: 1.1rem; transition: 0.2s; }
        .coupon-remove-btn:hover { transform: scale(1.1); }
        .cp-input-group { display: flex; gap: 10px; margin-bottom: 15px; }

        .free-del-msg { background: linear-gradient(135deg, #E8F5E9, #C8E6C9); color: #1B5E20; padding: 12px; border-radius: 14px; text-align: center; font-size: 0.9rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: var(--shadow-sm); }
        .free-del-msg.locked { background: linear-gradient(135deg, #FFF3E0, #FFE0B2); color: #E65100; }

        /* --- ORDERS --- */
        .order-container-web { max-width: 800px; margin: 0 auto; }
        .order-card { background: white; padding: 22px; border-radius: 20px; margin-bottom: 18px; box-shadow: var(--shadow-sm); cursor: pointer; position: relative; border-left: 6px solid transparent; transition: transform 0.2s; border: 1px solid #f9f9f9; }
        .order-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .st-placed { background: #FFF8E1; color: #F57F17; border-left-color: #F57F17; }
        .st-cooking { background: #E1F5FE; color: #0288D1; border-left-color: #0288D1; }
        .st-confirmed { background: #E0F7FA; color: #0097A7; border-left-color: #0097A7; }
        .st-completed { background: #E8F5E9; color: #2E7D32; border-left-color: #2E7D32; }
        .st-paid { background: #E0F2F1; color: #00897B; border-left-color: #00897B; }
        .st-cancelled { background: #FFEBEE; color: #D32F2F; border-left-color: #D32F2F; }
        .st-out_for_delivery { background: #F3E5F5; color: #7B1FA2; border-left-color: #7B1FA2; }

        /* TIMER & CONFIRM UI */
        .timer-strip { background: #FEF2F2; border: 1px solid #FECACA; padding: 10px; border-radius: 8px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; }
        .timer-val { font-family: monospace; font-size: 1rem; font-weight: 800; color: #DC2626; display: flex; align-items: center; gap: 6px; }
        .confirm-btn-sm { background: var(--success); color: white; border: none; padding: 5px 12px; border-radius: 6px; font-weight: 700; font-size: 0.75rem; cursor: pointer; animation: pulseGreen 2s infinite; }
        @keyframes pulseGreen { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

        /* TRACKING */
        .track-box { background: #F0FDF4; border: 1px solid #BBF7D0; padding: 15px; border-radius: 16px; margin-top: 15px; animation: fadeUp 0.5s; }
        .driver-row { display: flex; align-items: center; gap: 15px; margin-top: 10px; }
        .d-img-bg { width: 45px; height: 45px; background: white; border-radius: 50%; display: grid; place-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #eee; }
        .live-btn { background: var(--brand); color: white; padding: 8px 16px; border-radius: 50px; font-size: 0.75rem; font-weight: 700; text-decoration: none; display: flex; align-items: center; gap: 6px; animation: pulse 2s infinite; box-shadow: 0 4px 10px rgba(255,109,0,0.3); }
        .call-btn-circle { width: 40px; height: 40px; border-radius: 50%; background: white; border: 1px solid #eee; display: grid; place-items: center; color: var(--success); font-size: 1.1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 109, 0, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(255, 109, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 109, 0, 0); } }
        @keyframes fadeUp { from {opacity: 0; transform:translateY(10px);} to{opacity: 1; transform:translateY(0);}}
        @keyframes fadeInUp { from {opacity: 0; transform:translateY(20px);} to{opacity: 1; transform:translateY(0);}}

        /* --- PROFILE --- */
        .profile-bg-curve { background: linear-gradient(135deg, var(--brand), #EF6C00); height: 240px; width: 100%; border-radius: 0 0 60px 60px; position: absolute; top: 0; left: 0; z-index: 0; }
        .profile-wrapper { position: relative; z-index: 1; padding: 120px 20px 20px; max-width: 600px; margin: 0 auto; }
        .user-card { background: white; border-radius: 26px; padding: 50px 20px 30px; text-align: center; box-shadow: var(--shadow-lg); position: relative; margin-bottom: 25px; }
        .user-img-box { position: absolute; top: -65px; left: 50%; transform: translateX(-50%); width: 120px; height: 120px; background: white; padding: 5px; border-radius: 50%; box-shadow: 0 10px 30px rgba(255, 109, 0, 0.25); }
        .setting-section-title { font-size: 0.8rem; color: #94A3B8; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin: 0 0 10px 15px; }
        .setting-list { background: white; border-radius: 22px; padding: 8px; margin-bottom: 25px; box-shadow: var(--shadow-md); border: 1px solid #f1f5f9; }
        .setting-item { display: flex; align-items: center; justify-content: space-between; padding: 18px 16px; border-bottom: 1px solid #f6f6f6; cursor: pointer; transition: 0.2s; border-radius: 12px; }
        .setting-item:hover { background: #F8FAFC; }
        .setting-item:last-child { border-bottom: none; }
        .setting-left { display: flex; align-items: center; gap: 16px; }
        .setting-icon { width: 40px; height: 40px; border-radius: 14px; display: grid; place-items: center; font-size: 1.15rem; flex-shrink: 0; transition: 0.3s; }
        .icon-orange { background: #FFF3E0; color: #FF9800; }
        .icon-blue { background: #E3F2FD; color: #2196F3; }
        .icon-teal { background: #E0F2F1; color: #009688; }
        .icon-grey { background: #F5F5F5; color: #64748B; }
        .icon-red { background: #FEF2F2; color: #EF4444; }
        .setting-label { font-weight: 600; font-size: 0.95rem; color: #334155; }
        .guest-card-bg { background: linear-gradient(135deg, #fff, #FFF8E1); border: 1px solid #FFE0B2; text-align: center; padding: 40px 20px; border-radius: 24px; box-shadow: var(--shadow-md); }
        
        /* --- BOTTOM NAV --- */
        .btm-nav { position: fixed; bottom: 0; left: 0; right: 0; width: 100%; height: var(--nav-height); background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); display: grid; grid-template-columns: repeat(4, 1fr); box-shadow: 0 -5px 30px rgba(0,0,0,0.06); z-index: 90; border-top: 1px solid rgba(255,255,255,0.5); max-width: var(--max-width); margin: 0 auto; padding-bottom: 5px; }
        @media (max-width: 768px) { .btm-nav { border-radius: 24px 24px 0 0; } }
        .nav-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.7rem; color: #94A3B8; font-weight: 600; position: relative; transition: 0.3s; gap: 6px; cursor: pointer; }
        .nav-btn i { font-size: 1.4rem; transition: 0.3s; margin-bottom: 0px; }
        .nav-btn.active { color: var(--brand); }
        .nav-btn.active i { transform: translateY(-3px); filter: drop-shadow(0 4px 8px rgba(255,109,0,0.3)); font-size: 1.6rem; }

        /* --- FLOATING UI --- */
        #store-closed-ui { position: fixed; inset: 0; background: rgba(255,255,255,0.99); z-index: 4000; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 40px; }
        #float-bar { position: fixed; bottom: 95px; left: 20px; right: 20px; background: #1A1A1A; color: white; padding: 18px 25px; border-radius: 50px; display: none; align-items: center; justify-content: space-between; box-shadow: 0 15px 40px rgba(0,0,0,0.35); z-index: 95; cursor: pointer; animation: popUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); max-width: 600px; margin: 0 auto; backdrop-filter: blur(5px); }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 2000; display: none; flex-direction: column; justify-content: flex-end; backdrop-filter: blur(6px); }
        .modal.open { display: flex; animation: fadeUp 0.3s forwards; }
        .modal-body { background: white; width: 100%; max-height: 85vh; border-radius: 32px 32px 0 0; padding: 35px 25px; overflow-y: auto; box-shadow: 0 -10px 50px rgba(0,0,0,0.25); max-width: 600px; margin: 0 auto; }
        @media(min-width: 600px) {
            .modal { justify-content: center; align-items: center; }
            .modal-body { border-radius: 25px; max-width: 500px; max-height: 80vh; }
        }
        
        @keyframes fadeUp { from {opacity:0;} to{opacity:1;} }
        @keyframes popUp { from {transform: scale(0.8) translateY(20px); opacity:0;} to{transform: scale(1) translateY(0); opacity:1;} }
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #1E293B; color: white; padding: 16px 30px; border-radius: 50px; font-size: 0.9rem; font-weight: 600; z-index: 5000; opacity: 0; pointer-events: none; transition: 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 12px; white-space: nowrap; }
        .toast.show { bottom: 120px; opacity: 1; }
        
        #m-exit-body { border-radius: 24px; padding: 35px; text-align: center; margin: auto; max-width: 340px; }
        .pay-option { display: flex; align-items: center; padding: 15px; border: 1px solid #e2e8f0; border-radius: 12px; margin-bottom: 10px; cursor: pointer; transition: 0.2s; }
        .pay-option:hover { background: #f8fafc; }
        .pay-option input { margin-right: 12px; transform: scale(1.3); accent-color: var(--brand); }
        .pay-label { font-weight: 600; color: #334155; font-size: 0.95rem; }
        .min-order-warning { background: #FEF2F2; color: #DC2626; padding: 12px; font-size: 0.85rem; font-weight: 600; text-align: center; border-radius: 8px; border: 1px solid #xFCA5A5; margin-bottom: 15px; display: none; }
        .pay-disc-tag { background: #ECFDF5; color: #059669; padding: 2px 8px; font-size: 0.75rem; border-radius: 4px; margin-left: 8px; border: 1px solid #A7F3D0; font-weight: 700; }

    </style>
<link rel="me" href="https://www.blogger.com/profile/18035977914919880974" />
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>
</head>
<body>

    <div class="app-container">
        
        <!-- 1. AUTHENTICATION OVERLAY -->
        <div id="auth-overlay" class="hide">
            <div class="auth-close" onclick="closeAuthOverlay()"><i class="fa-solid fa-xmark"></i></div>
            <div class="auth-content">
                <div class="logo-ring">
                    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhKkhc5IkA65STmeUrIgSBI6nDpLrBG5GmZ1pzSkHZnSl5pTc1fzyHFmg1wqwDkeEaa0HZM6vcNk2WWTPuUpvhq-Uee_FUtPQwP2OUyAg8wzbJV1rk6_lCx1X0UlRuxpgulL3trFgzRAvgI1-aSRojJJWUMChXOl9yRSmsOLoHrdmOVDh8gVeUop5T3_VzU/s256/1000198120.png" alt="Logo">
                </div>
                <h2 style="font-weight: 800; color: var(--text-main); font-size: 1.6rem; letter-spacing: -0.5px; margin-bottom: 5px;">Govinda's Prasadam</h2>
                <p style="color: #64748B; margin-bottom: 30px; font-size: 0.95rem;">ISKCON Hadapsar | Pune</p>
                <button class="btn btn-google" onclick="googleLogin()">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="22" alt="G">
                    <span>Login with Google</span>
                </button>
                <div class="divider">OR USE EMAIL</div>
                <div id="login-form">
                    <form onsubmit="return false">
                        <input type="email" id="l-email" class="auth-inp" placeholder="email@gmail.com" required>
                        <input type="password" id="l-pass" class="auth-inp" placeholder="Password" required>
                        <div style="text-align: right; margin-bottom: 25px;">
                            <span style="color:var(--brand); font-size:0.85rem; font-weight:700; cursor:pointer;" onclick="toggleAuth('forgot')">Forgot Password?</span>
                        </div>
                        <button type="button" class="btn btn-brand" onclick="login()"><i class="fa-solid fa-lock"></i> SECURE LOGIN</button>
                    </form>
                    <button class="btn btn-sec" onclick="toggleAuth('signup')">Create New Account</button>
                </div>
                <div id="signup-form" class="hide">
                    <form onsubmit="return false">
                        <input type="text" id="s-name" class="auth-inp" placeholder="Full Name" required>
                        <input type="email" id="s-email" class="auth-inp" placeholder="Valid Gmail (@gmail.com)" required>
                        <input type="tel" id="s-phone" class="auth-inp" placeholder="10 Digit Mobile Number" maxlength="10" required>
                        <input type="text" id="s-addr" class="auth-inp" placeholder="Full Delivery Address" required>
                        <input type="password" id="s-pass" class="auth-inp" placeholder="Create Password" required>
                        <button type="button" class="btn btn-brand" onclick="signup()">CREATE ACCOUNT</button>
                    </form>
                    <button class="btn btn-sec" onclick="toggleAuth('login')">Already have account?</button>
                </div>
                <div id="forgot-form" class="hide">
                    <h3 style="margin-bottom:10px;">Reset Password</h3>
                    <p style="color:#666; font-size:0.9rem; margin-bottom:20px;">Link will be sent to registered gmail.</p>
                    <form onsubmit="return false">
                        <input type="email" id="f-email" class="auth-inp" placeholder="Enter Registered Gmail">
                        <button type="button" class="btn btn-brand" onclick="forgotPass()">SEND RESET LINK</button>
                    </form>
                    <button class="btn btn-sec" onclick="toggleAuth('login')">Cancel</button>
                </div>
                <p id="auth-msg" style="color: var(--error); margin-top: 20px; font-size: 0.9rem; font-weight: 700;"></p>
            </div>
        </div>

        <!-- 2. OFFLINE UI -->
        <div id="store-closed-ui" class="hide">
            <i class="fa-solid fa-shop-slash" style="font-size: 5rem; color: #ECEFF1; margin-bottom: 25px;"></i>
            <h2 style="font-weight: 800; margin-bottom: 10px;">Kitchen Closed</h2>
            <p style="color: #666; margin-bottom: 25px; line-height: 1.5; max-width: 80%;">We are currently offline. Please check back during service hours.</p>
            <button class="btn btn-brand" style="width: auto; padding: 12px 35px;" onclick="window.location.reload()">REFRESH STATUS</button>
        </div>

        <!-- APP HEADER -->
        <header class="app-header" id="header-main">
            <div class="brand-box">
                <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhKkhc5IkA65STmeUrIgSBI6nDpLrBG5GmZ1pzSkHZnSl5pTc1fzyHFmg1wqwDkeEaa0HZM6vcNk2WWTPuUpvhq-Uee_FUtPQwP2OUyAg8wzbJV1rk6_lCx1X0UlRuxpgulL3trFgzRAvgI1-aSRojJJWUMChXOl9yRSmsOLoHrdmOVDh8gVeUop5T3_VzU/s256/1000198120.png" class="brand-logo" alt="GP">
                <div class="brand-info">
                    <div class="brand-name">Govinda's Prasadam</div>
                    <div class="brand-tag">Pure Veg</div>
                </div>
            </div>
            <div class="loc-row" onclick="findLoc()">
                <i class="fa-solid fa-location-dot loc-icon-bg"></i>
                <div class="loc-txt ellipsis" id="disp-addr">Detecting...</div>
            </div>
        </header>

        <!-- NAVIGATION -->
        <nav class="btm-nav" id="navbar">
            <div class="nav-btn active" onclick="nav('view-home', this)"><i class="fa-solid fa-house"></i> Home</div>
            <div class="nav-btn" id="nav-cart" onclick="nav('view-cart', this)">
                <i class="fa-solid fa-bag-shopping"></i> Plate
                <div id="nav-badge" class="center" style="position:absolute; top:8px; right:20px; width:8px; height:8px; background:var(--error); border-radius:50%; display:none;"></div>
            </div>
            <div class="nav-btn" onclick="nav('view-orders', this)"><i class="fa-solid fa-receipt"></i> Orders</div>
            <div class="nav-btn" onclick="nav('view-profile', this)"><i class="fa-solid fa-user"></i> Account</div>
        </nav>

        <!-- ==== VIEW: HOME ==== -->
        <div id="view-home" class="view">
            <div class="banner-wrapper">
                <div class="slider-box" id="slider-box"></div>
                <div class="slider-dots" id="slider-dots"></div>
                <button class="slider-btn s-prev" style="display:none;" onclick="slide(-1)"><i class="fa-solid fa-chevron-left"></i></button>
                <button class="slider-btn s-next" style="display:none;" onclick="slide(1)"><i class="fa-solid fa-chevron-right"></i></button>
            </div>
            <div style="padding: 10px 0 0;">
                <div class="flex-between" style="padding: 0 15px; margin-bottom: 10px;">
                    <h4 style="font-weight:800; color: #1E293B; letter-spacing:-0.3px; margin-left: 10px;">Explore Menu</h4>
                </div>
                <div class="cat-scroll" id="cat-box"></div>
            </div>
            <div style="padding: 10px 0px;">
                <h4 style="margin-bottom: 18px; font-weight:800; color: #1E293B; padding: 0 15px; margin-left: 10px;">Pure Veg Delicacies</h4>
                <div class="prod-grid" id="prod-box">
                    <div class="center" style="padding:50px;"><i class="fa-solid fa-circle-notch fa-spin fa-2x" style="color:var(--brand)"></i></div>
                </div>
            </div>
            <div style="height:60px;"></div>
        </div>

        <!-- ==== VIEW: PRODUCT DETAILS ==== -->
        <div id="view-product" class="view hide">
            <div class="pd-header pd-mobile-top">
                <div class="pd-back-btn" onclick="nav('view-home', null, true)"><i class="fa-solid fa-arrow-left"></i></div>
                <div class="pd-back-btn" onclick="nav('view-cart', document.getElementById('nav-cart'))"><i class="fa-solid fa-bag-shopping"></i></div>
            </div>
            <div class="desktop-pd-split">
                <div class="pd-gallery" id="pd-gallery-box"></div>
                <div class="pd-content">
                    <div class="hide" style="display:none; text-align:right;" id="dt-close-btn">
                        <button onclick="nav('view-home', null, true)" style="border:none; background:#eee; width:30px; height:30px; border-radius:50%; cursor:pointer;">X</button>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div>
                            <div class="veg-tag"><div class="veg-dot"></div></div>
                            <div class="pd-title" id="pd-name">--</div>
                            <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
                                <div style="background:var(--success); color:white; padding:2px 6px; border-radius:4px; font-size:0.8rem; font-weight:700; display:flex; align-items:center; gap:3px;">
                                    <span id="pd-rating-val">0.0</span> <i class="fa-solid fa-star" style="font-size:0.6rem;"></i>
                                </div>
                                <span style="font-size:0.8rem; color:var(--text-light); font-weight:600; text-decoration:underline; cursor:pointer;" onclick="document.getElementById('reviews-anchor').scrollIntoView({behavior:'smooth'})" id="pd-review-count">0 Reviews</span>
                            </div>
                            <div class="pd-unit" id="pd-unit">--</div>
                        </div>
                    </div>
                    <div class="pd-price"><span id="pd-price">--</span></div>
                    <h4 style="margin-bottom:10px; color:#333;">Description</h4>
                    <p class="pd-desc" id="pd-desc">--</p>
                    <div id="pd-action-box-inline" style="margin-top: 20px;"></div>

                    <!-- REVIEWS SECTION -->
                    <div id="reviews-anchor" class="reviews-section">
                        <div class="rev-header">
                            <div class="rev-title">Ratings & Reviews</div>
                            <div class="rev-add-btn" onclick="openReviewModal()">
                                <i class="fa-regular fa-pen-to-square"></i> <span id="btn-write-rev-text">Write Review</span>
                            </div>
                        </div>
                        <div id="reviews-list-box"></div>
                    </div>

                    <div class="related-box" id="related-section">
                        <div class="related-title">You May Also Like</div>
                        <div class="related-scroll" id="related-box"></div>
                    </div>
                </div>
            </div>
            <div class="pd-footer" id="pd-action-box"></div>
        </div>

        <!-- ==== VIEW: CART ==== -->
        <div id="view-cart" class="view hide" style="background:var(--white); min-height:100vh;">
            <div class="cart-container-web">
                <div class="app-header" style="justify-content: space-between;">
                    <h2 style="font-weight:800;">Your Plate</h2>
                    <i class="fa-solid fa-trash-can" style="color:var(--error); cursor:pointer;" onclick="clearCart()"></i>
                </div>
                <div id="cart-empty" class="cart-empty-state hide">
                    <img src="https://cdn-icons-png.flaticon.com/512/11329/11329060.png" alt="Empty">
                    <h3 style="margin-bottom:10px; color:#2D3436; font-weight:800;">Plate is Empty</h3>
                    <p style="color:#888; font-size:0.95rem; margin-bottom:25px;">Add some divine prasadam to continue.</p>
                    <button class="btn btn-brand" style="width:auto; padding: 14px 40px;" onclick="nav('view-home')">BROWSE MENU</button>
                </div>
                <div id="cart-content" style="padding: 15px;">
                    <div id="free-del-bar" class="free-del-msg locked">Checking Delivery Offers...</div>
                    <div id="cart-items" style="display:grid; gap:12px;"></div>
                    <div class="bill-sec" id="checkout-box">
                        <div style="font-weight:800; font-size:1rem; margin-bottom:15px; color:#2D3436;">Ordering For</div>
                        <div id="coupon-section">
                            <div id="cp-input-ui" class="cp-input-group">
                                <input type="text" id="cp-code" placeholder="PROMO CODE" class="auth-inp" style="margin:0; text-transform:uppercase; font-weight:700; letter-spacing:1px;" onkeydown="if(event.key === 'Enter'){event.preventDefault(); applyCp();}">
                                <button type="button" class="btn btn-brand" style="width:auto; padding:0 25px;" onclick="applyCp()">APPLY</button>
                            </div>
                            <div id="cp-applied-ui" class="coupon-box-applied hide">
                                <div style="display:flex; align-items:center; gap:12px;">
                                    <div style="background:#15803d; width:36px; height:36px; border-radius:50%; display:grid; place-items:center; color:white;"><i class="fa-solid fa-percent"></i></div>
                                    <div>
                                        <div class="coupon-code-tag" id="disp-cp-code">CODE</div>
                                        <div style="font-size:0.8rem; color:#15803d; font-weight:700; margin-top:4px;" id="disp-cp-desc">Savings Applied</div>
                                    </div>
                                </div>
                                <i class="fa-solid fa-xmark coupon-remove-btn" onclick="removeCp()"></i>
                            </div>
                            <div id="cp-res" style="text-align:right; font-size:0.8rem; margin-top:-10px; margin-bottom:15px; font-weight:700;"></div>
                        </div>
                        <div class="bill-row"><span>Item Total</span><span id="b-item">₹0</span></div>
                        <div class="bill-row" style="color:var(--success)"><span>Discount</span><span id="b-disc">- ₹0</span></div>
                        <div class="bill-row" id="row-online-disc" style="display:none; color:var(--brand);">
                            <span>Online Offer</span><span id="b-online-disc">- ₹0</span>
                        </div>
                        <div class="bill-row"><span>Delivery Fee</span><span id="b-del">₹20</span></div>
                        <div class="bill-total"><span>To Pay</span><span id="b-total" style="color:var(--brand);">₹0</span></div>
                        <div style="margin-top:25px; border-top:1px solid #f5f5f5; padding-top:15px;">
                            <div id="min-order-msg" class="min-order-warning">Minimum Order Amount is ₹100</div>
                            <p style="font-weight:700; font-size:0.9rem; margin-bottom:5px; color:#555;">Name</p>
                            <input type="text" id="final-name" class="auth-inp" placeholder="Receiver Name">
                            <p style="font-weight:700; font-size:0.9rem; margin-bottom:5px; color:#555;">Phone</p>
                            <input type="tel" id="final-phone" class="auth-inp" placeholder="Mobile Number">
                            <p style="font-weight:700; font-size:0.9rem; margin-bottom:5px; color:#555;">Delivery Address</p>
                            <textarea id="final-addr" class="auth-inp" rows="2" placeholder="Full Address with Landmark..."></textarea>
                            <p style="font-weight:700; font-size:0.9rem; margin-bottom:10px; color:#555; margin-top:15px;">Payment Method</p>
                            <label class="pay-option">
                                <input type="radio" name="pay-mode" value="online" checked onchange="refreshCart()">
                                <div>
                                    <span class="pay-label">Online Payment (Razorpay)</span>
                                    <span id="online-offer-badge" class="pay-disc-tag" style="display:none;">% OFF</span>
                                </div>
                            </label>
                            <label class="pay-option" id="cod-opt-row">
                                <input type="radio" name="pay-mode" value="cod" onchange="refreshCart()">
                                <span class="pay-label">Cash on Delivery</span>
                            </label>
                            <button type="button" id="btn-place-order" class="btn btn-brand" onclick="placeOrder()" style="margin-top:10px;">
                                <span>PLACE ORDER</span> <i class="fa-solid fa-angle-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div style="height:100px;"></div>
        </div>

        <!-- ==== VIEW: ORDERS ==== -->
        <div id="view-orders" class="view hide" style="padding:20px 15px;">
            <div class="order-container-web">
                <h2 style="margin:10px 0 25px; font-weight:800; color:#2D3436;">Your Orders</h2>
                <div id="orders-list"></div>
                <div style="height:80px;"></div>
            </div>
        </div>

        <!-- ==== VIEW: PROFILE ==== -->
        <div id="view-profile" class="view hide">
            <div class="profile-bg-curve"></div>
            <div class="profile-wrapper">
                <div id="profile-guest" class="hide">
                    <div class="user-card guest-card-bg">
                        <i class="fa-solid fa-user-circle" style="font-size:4rem; color:var(--brand); margin-bottom:15px;"></i>
                        <h2 style="font-weight:800; color:var(--text-main);">Welcome, Devotee!</h2>
                        <p style="color:var(--text-light); margin:10px 0 20px;">Login to view your orders and manage profile.</p>
                        <button class="btn btn-brand" onclick="openLoginModal()" style="width:200px; margin:0 auto;">LOGIN / SIGNUP</button>
                    </div>
                </div>
                <div id="profile-user" class="hide">
                    <div class="user-card">
                        <div class="user-img-box">
                            <img id="p-img" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhKkhc5IkA65STmeUrIgSBI6nDpLrBG5GmZ1pzSkHZnSl5pTc1fzyHFmg1wqwDkeEaa0HZM6vcNk2WWTPuUpvhq-Uee_FUtPQwP2OUyAg8wzbJV1rk6_lCx1X0UlRuxpgulL3trFgzRAvgI1-aSRojJJWUMChXOl9yRSmsOLoHrdmOVDh8gVeUop5T3_VzU/s256/1000198120.png" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                        </div>
                        <h2 id="p-name" style="margin-top:15px; font-weight:800; font-size:1.4rem;">Guest User</h2>
                        <div id="p-phone" style="font-size:0.95rem; color:var(--text-light); font-weight:600; margin:5px 0 15px;">+91 --</div>
                        <div style="font-size:0.8rem; color:#aaa;" id="p-email">--</div>
                        <button class="btn btn-sec" onclick="openEdit()" style="padding:8px 25px; width:auto; border:1px solid #eee; border-radius:30px; margin:10px auto; font-size:0.8rem;">Edit Profile</button>
                    </div>
                    <div class="setting-section-title">Account</div>
                    <div class="setting-list">
                        <div class="setting-item" onclick="nav('view-orders', document.querySelectorAll('.nav-btn')[2])">
                            <div class="setting-left">
                                <div class="setting-icon icon-orange"><i class="fa-solid fa-clock-rotate-left"></i></div>
                                <div class="setting-label">My Orders</div>
                            </div>
                            <i class="fa-solid fa-angle-right" style="color:#ddd;"></i>
                        </div>
                        <div class="setting-item" onclick="openEdit()">
                            <div class="setting-left">
                                <div class="setting-icon icon-teal"><i class="fa-solid fa-map-location-dot"></i></div>
                                <div class="setting-label">Manage Address</div>
                            </div>
                            <i class="fa-solid fa-angle-right" style="color:#ddd;"></i>
                        </div>
                    </div>
                </div>
                <div class="setting-section-title">Support & Legal</div>
                <div class="setting-list">
                    <div class="setting-item" onclick="window.location.href='about.html'">
                        <div class="setting-left"><div class="setting-icon icon-blue"><i class="fa-solid fa-store"></i></div><div class="setting-label">About Govinda's</div></div><i class="fa-solid fa-angle-right" style="color:#ddd;"></i>
                    </div>
                    <div class="setting-item" onclick="window.location.href='refund-policy.html'">
                        <div class="setting-left"><div class="setting-icon icon-grey"><i class="fa-solid fa-money-bill-transfer"></i></div><div class="setting-label">Refund Policy</div></div><i class="fa-solid fa-angle-right" style="color:#ddd;"></i>
                    </div>
                    <div class="setting-item" onclick="window.location.href='shipping-policy.html'">
                        <div class="setting-left"><div class="setting-icon icon-grey"><i class="fa-solid fa-truck-fast"></i></div><div class="setting-label">Shipping Policy</div></div><i class="fa-solid fa-angle-right" style="color:#ddd;"></i>
                    </div>
                    <div class="setting-item" onclick="window.location.href='terms.html'">
                        <div class="setting-left"><div class="setting-icon icon-grey"><i class="fa-solid fa-file-contract"></i></div><div class="setting-label">Terms & Conditions</div></div><i class="fa-solid fa-angle-right" style="color:#ddd;"></i>
                    </div>
                    <div class="setting-item" onclick="window.location.href='privacy.html'">
                        <div class="setting-left"><div class="setting-icon icon-grey"><i class="fa-solid fa-shield-halved"></i></div><div class="setting-label">Privacy Policy</div></div><i class="fa-solid fa-angle-right" style="color:#ddd;"></i>
                    </div>
                    <div class="setting-item" onclick="window.location.href='contact.html'">
                        <div class="setting-left"><div class="setting-icon icon-blue"><i class="fa-solid fa-headset"></i></div><div class="setting-label">Contact Support</div></div><i class="fa-solid fa-angle-right" style="color:#ddd;"></i>
                    </div>
                </div>
                <div id="logout-btn-box" class="setting-list hide" style="margin-bottom:40px;">
                    <div class="setting-item" onclick="authOut()">
                        <div class="setting-left"><div class="setting-icon icon-red"><i class="fa-solid fa-power-off"></i></div><div class="setting-label" style="color:var(--error);">Logout</div></div>
                    </div>
                </div>
                <div style="text-align:center; color:#ccc; font-size:0.75rem; padding-bottom:100px; display:flex; flex-direction:column; align-items:center;">
                    <span>Version 20.0 (Premium) | Govinda's Prasadam</span>
                    <span style="margin-top:5px; background:#e2e8f0; padding:5px 12px; border-radius:15px; color:#475569; font-weight:700; font-size:0.7rem;">Developed with ❤️ by Santosh</span>
                </div>
            </div>
        </div>

        <div id="float-bar" onclick="nav('view-cart', document.getElementById('nav-cart'))">
            <div style="display:flex; flex-direction:column;">
                <span style="font-weight:800; font-size:0.9rem;" id="fl-qty">1 Item</span>
                <span style="font-size:0.8rem; opacity:0.9;">Total: <span id="fl-total">₹100</span></span>
            </div>
            <div style="font-weight:700; font-size:0.9rem; display:flex; align-items:center; gap:8px;">View Plate <i class="fa-solid fa-circle-chevron-right" style="font-size:1.1rem; color:var(--brand);"></i></div>
        </div>

        <!-- MODALS -->
        <!-- REVIEW MODAL -->
        <div id="m-review" class="modal">
            <div class="modal-body">
                <div class="flex-between" style="margin-bottom:20px;">
                    <h3 style="font-weight:800;">Write Review</h3>
                    <div style="background:#f4f4f4; width:35px; height:35px; border-radius:50%; display:grid; place-items:center; cursor:pointer;" onclick="shutMod()"><i class="fa-solid fa-xmark"></i></div>
                </div>
                <div style="text-align:center;">
                    <p style="color:#666; font-size:0.9rem;">Tap stars to rate</p>
                    <div class="star-input-group">
                        <input type="radio" id="star5" name="rate" value="5"><label for="star5" title="5"><i class="fa-solid fa-star"></i></label>
                        <input type="radio" id="star4" name="rate" value="4"><label for="star4" title="4"><i class="fa-solid fa-star"></i></label>
                        <input type="radio" id="star3" name="rate" value="3"><label for="star3" title="3"><i class="fa-solid fa-star"></i></label>
                        <input type="radio" id="star2" name="rate" value="2"><label for="star2" title="2"><i class="fa-solid fa-star"></i></label>
                        <input type="radio" id="star1" name="rate" value="1"><label for="star1" title="1"><i class="fa-solid fa-star"></i></label>
                    </div>
                </div>
                <textarea id="rev-msg" class="auth-inp" rows="4" placeholder="Share your experience... (Divine taste, packaging, etc.)"></textarea>
                <button class="btn btn-brand" onclick="submitReview()">SUBMIT REVIEW</button>
            </div>
        </div>

        <!-- Edit Profile -->
        <div id="m-edit" class="modal">
            <div class="modal-body">
                <div class="flex-between" style="margin-bottom:20px;">
                    <h3 style="font-weight:800;">Update Details</h3>
                    <div style="background:#f4f4f4; width:35px; height:35px; border-radius:50%; display:grid; place-items:center; cursor:pointer;" onclick="shutMod()"><i class="fa-solid fa-xmark"></i></div>
                </div>
                <form onsubmit="return false">
                    <label style="font-size:0.85rem; font-weight:700; color:#555;">Display Name</label>
                    <input type="text" id="e-name" class="auth-inp">
                    <label style="font-size:0.85rem; font-weight:700; color:#555;">Mobile Number</label>
                    <input type="tel" id="e-phone" class="auth-inp" maxlength="10">
                    <label style="font-size:0.85rem; font-weight:700; color:#555;">Saved Address</label>
                    <textarea id="e-addr" class="auth-inp" rows="3"></textarea>
                    <button type="button" class="btn btn-brand" onclick="saveProfile()" style="margin-top:10px;">SAVE CHANGES</button>
                </form>
            </div>
        </div>

        <!-- COMPLETE PROFILE MODAL -->
        <div id="m-complete-profile" class="modal" style="z-index: 3500;">
            <div class="modal-body">
                <h3 style="font-weight:800; margin-bottom: 5px;">One Last Step!</h3>
                <p style="color:#666; margin-bottom: 20px;">Please provide details to enable delivery.</p>
                <form onsubmit="return false">
                    <input type="tel" id="c-phone" class="auth-inp" placeholder="10 Digit Mobile Number" maxlength="10">
                    <textarea id="c-addr" class="auth-inp" rows="2" placeholder="Full Delivery Address"></textarea>
                    <button type="button" class="btn btn-brand" onclick="completeProfile()">SAVE & CONTINUE</button>
                </form>
            </div>
        </div>

        <!-- Exit Confirmation Modal -->
        <div id="m-exit" class="modal" style="justify-content: center; backdrop-filter: blur(10px);">
            <div class="modal-body" id="m-exit-body">
                <i class="fa-solid fa-door-open" style="font-size: 3rem; color: #555; margin-bottom: 20px;"></i>
                <h3 style="font-weight: 800; color: var(--text-main); margin-bottom: 10px;">Exit App?</h3>
                <p style="color: #666; font-size: 0.95rem; margin-bottom: 25px;">Do you really want to close the Govinda's Prasadam app?</p>
                <div class="flex-between" style="gap: 15px;">
                    <button class="btn btn-sec" style="background:#f5f5f5; color:#333;" onclick="closeExitModal()">CANCEL</button>
                    <button class="btn btn-brand" onclick="confirmExit()">EXIT</button>
                </div>
            </div>
        </div>

        <!-- Order Receipt -->
        <div id="m-bill" class="modal">
            <div class="modal-body" id="bill-content"></div>
        </div>

        <div id="toast" class="toast">
            <i class="fa-solid fa-circle-check" style="color:#10B981; font-size:1.2rem;"></i>
            <span id="toast-msg">Action Successful</span>
        </div>

    </div>

    <!-- LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, sendPasswordResetEmail, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getDatabase, ref, update, onValue, set, push, serverTimestamp, get, query, limitToLast } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyAn38HlPSpz7yRZUmDG7qnedplFjv3WvAE",
            authDomain: "iskcon-food.firebaseapp.com",
            databaseURL: "https://iskcon-food-default-rtdb.firebaseio.com",
            projectId: "iskcon-food",
            storageBucket: "iskcon-food.firebasestorage.app",
            messagingSenderId: "987150159471",
            appId: "1:987150159471:web:c5f8506191ef06d147479a"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        
        let USER = null;
        let IS_GUEST = true;
        let CART = JSON.parse(localStorage.getItem('gp_v8_cart') || "[]");
        let COUPON = JSON.parse(localStorage.getItem('gp_v8_coupon') || "null");
        let PRODS = [];
        let STORE_OPEN = true;
        let DELIVERY_FEE = 20; 
        let MIN_FREE_DELIVERY = 500;
        let MIN_ORDER_VAL = 0; 
        let ONLINE_DISC = 0; 
        let COD_ENABLE = true;
        let CURRENT_PROD = null; 
        let slideInterval = null;
        
        const isValidGmail = (email) => /^[a-zA-Z0-9._%+-]+@gmail\.com$/.test(String(email).toLowerCase());
        const isValidPhone = (p) => /^\d{10}$/.test(p);
        const escapeHtml = (text) => {
            if(!text) return '';
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return text.toString().replace(/[&<>"']/g, function(m) { return map[m]; });
        };

        onAuthStateChanged(auth, u => {
            if(u) {
                USER = u;
                IS_GUEST = false;
                document.getElementById('auth-overlay').classList.add('hide');
                document.getElementById('profile-guest').classList.add('hide');
                document.getElementById('profile-user').classList.remove('hide');
                document.getElementById('logout-btn-box').classList.remove('hide');
                initData(u.uid, u);
            } else {
                USER = null;
                IS_GUEST = true;
                document.getElementById('profile-guest').classList.remove('hide');
                document.getElementById('profile-user').classList.add('hide');
                document.getElementById('logout-btn-box').classList.add('hide');
                initData(null, null); 
            }
        });

        window.openLoginModal = () => document.getElementById('auth-overlay').classList.remove('hide');
        window.closeAuthOverlay = () => document.getElementById('auth-overlay').classList.add('hide');
        
        window.googleLogin = () => {
            const provider = new GoogleAuthProvider();
            signInWithPopup(auth, provider).then(async (result) => {
                const user = result.user;
                const snap = await get(ref(db, `customers/${user.uid}`));
                const data = snap.val();
                if (!data || !data.phone || !data.address) {
                    document.getElementById('auth-overlay').classList.add('hide');
                    document.getElementById('m-complete-profile').classList.add('open');
                } else toast(`Welcome ${user.displayName}`);
            }).catch((error) => err(error.message));
        };

        window.completeProfile = () => {
            const p = val('c-phone');
            const a = val('c-addr');
            if(!isValidPhone(p)) return toast("Enter valid 10-digit Phone");
            if(a.length < 5) return toast("Enter valid address");
            if(auth.currentUser) {
                update(ref(db, `customers/${auth.currentUser.uid}`), { phone: p, address: a }).then(() => {
                    document.getElementById('m-complete-profile').classList.remove('open');
                    toast("Profile Completed!");
                    initData(auth.currentUser.uid, auth.currentUser);
                });
            }
        };

        window.login = () => {
            const e = val('l-email'), p = val('l-pass');
            if(!isValidGmail(e)) return err("Only @gmail.com addresses allowed");
            signInWithEmailAndPassword(auth, e, p).catch(e => err(e.message));
        };

        window.signup = () => {
            const n=val('s-name'), e=val('s-email'), p=val('s-pass'), ph=val('s-phone'), ad=val('s-addr');
            if(!n || !e || !p || !ph || !ad) return err("Please fill all details");
            if(!isValidGmail(e)) return err("Use valid @gmail.com address only");
            if(!isValidPhone(ph)) return err("Mobile number must be exactly 10 digits");
            if(p.length < 6) return err("Password must be 6+ chars");
            createUserWithEmailAndPassword(auth, e, p).then(c => {
                set(ref(db, `customers/${c.user.uid}`), { name:escapeHtml(n), email:e, phone:ph, address:escapeHtml(ad), joined:serverTimestamp() });
            }).catch(e => err(e.message));
        };

        window.forgotPass = () => {
            const email = val('f-email');
            if(!isValidGmail(email)) return err("Enter valid @gmail.com");
            sendPasswordResetEmail(auth, email).then(() => { alert(`Reset Link sent to ${email}`); toggleAuth('login'); }).catch(error => err(error.message));
        };

        window.authOut = () => signOut(auth);
        window.toggleAuth = (t) => {
            ['login','signup','forgot'].forEach(x => document.getElementById(x+'-form').classList.add('hide'));
            document.getElementById(t+'-form').classList.remove('hide');
            document.getElementById('auth-msg').innerText = ''; 
        };

        function initData(uid, userObj) {
            onValue(ref(db, 'settings'), s => {
                const val = s.val() || {};
                STORE_OPEN = val.store_open !== false;
                DELIVERY_FEE = parseInt(val.delivery_fee) || 20;
                MIN_FREE_DELIVERY = parseInt(val.min_free_delivery) || 500;
                MIN_ORDER_VAL = parseInt(val.min_order_value) || 0; 
                ONLINE_DISC = parseInt(val.online_discount) || 0; 
                COD_ENABLE = val.cod_enabled !== false; 
                document.getElementById('store-closed-ui').classList.toggle('hide', STORE_OPEN);
                refreshCart(); 
            });

            onValue(ref(db, 'sliders'), s => {
                const b = document.getElementById('slider-box');
                const d = document.getElementById('slider-dots');
                b.innerHTML = ''; d.innerHTML = '';
                const slides = s.exists() ? Object.values(s.val()) : [];
                if(slides.length > 0) {
                    slides.forEach((x, i) => {
                        b.innerHTML += `<div class="slide" style="background-image:url('${x.image}')"></div>`;
                        d.innerHTML += `<div class="dot ${i===0?'active':''}" id="dot-${i}"></div>`;
                    });
                    if(slideInterval) clearInterval(slideInterval);
                    slideInterval = setInterval(() => slide(1, true), 3000); 
                }
            });

            onValue(ref(db, 'categories'), s => {
                const b = document.getElementById('cat-box');
                let h = `<div class="cat-item active" onclick="filt('all',this)"><img src="https://cdn-icons-png.flaticon.com/512/706/706164.png" class="cat-img"><div class="cat-name">All</div></div>`;
                if(s.exists()) Object.values(s.val()).forEach(x => { 
                    if(x.active) h += `<div class="cat-item" onclick="filt('${x.name}',this)"><img src="${x.image}" class="cat-img"><div class="cat-name">${x.name}</div></div>`; 
                });
                b.innerHTML = h;
            });

            onValue(ref(db, 'menu'), s => {
                PRODS = [];
                if(s.exists()) Object.entries(s.val()).forEach(([k,v]) => PRODS.push({id:k, ...v}));
                renderMenu(PRODS);
            });

            if(uid) {
                onValue(ref(db, `customers/${uid}`), s => {
                    let u = s.val();
                    if (u && !u.photo && userObj && userObj.photoURL) update(ref(db, `customers/${uid}`), {photo: userObj.photoURL});
                    if(!u && userObj) {
                        u = { name: userObj.displayName || "User", email: userObj.email, phone: "", address: "", photo: userObj.photoURL || "", joined: serverTimestamp() };
                        set(ref(db, `customers/${uid}`), u);
                    }
                    if(u) {
                        document.getElementById('p-name').innerText = u.name;
                        document.getElementById('p-phone').innerText = u.phone || "No Phone Set";
                        document.getElementById('p-email').innerText = u.email;
                        if(u.photo) document.getElementById('p-img').src = u.photo;
                        document.getElementById('e-name').value = u.name;
                        document.getElementById('e-phone').value = u.phone || "";
                        document.getElementById('e-addr').value = u.address || "";
                        document.getElementById('final-name').value = u.name;
                        document.getElementById('final-phone').value = u.phone || "";
                        if(u.address) {
                            document.getElementById('disp-addr').innerText = u.address;
                            document.getElementById('final-addr').value = u.address;
                        }
                    }
                });
                onValue(query(ref(db, 'orders'), limitToLast(30)), s => renderHistory(s.val()));
            } else {
                document.getElementById('orders-list').innerHTML = '<div class="center" style="margin-top:50px; color:#aaa;">Login to view orders</div>';
            }
        }

        window.slide = (dir, auto=false) => {
            const box = document.getElementById('slider-box');
            if(!box) return; 
            const w = box.clientWidth;
            const max = box.scrollWidth - w;
            let next = box.scrollLeft + (w * dir);
            if (auto && next > max + 10) next = 0; 
            else if (!auto) { if(next < 0) next = 0; if(next > max) next = max; }
            box.scrollTo({ left: next, behavior: 'smooth' });
            setTimeout(() => {
                const idx = Math.round(box.scrollLeft / w);
                document.querySelectorAll('.dot').forEach((e, i) => {
                    if(i === idx) e.classList.add('active'); else e.classList.remove('active');
                });
            }, 300); 
        };

        // --- MNC LEVEL REVIEW SYSTEM (HYBRID) ---
        function getLegacyReviewData(id) {
            // Generates deterministic stats based on ID (Simulating Swiggy Migration)
            let sum = 0; for(let i=0; i<id.length; i++) sum += id.charCodeAt(i);
            const baseCount = 50 + (sum % 900); // Between 50 and 950 reviews
            const baseRating = 4.2 + ((sum % 8) / 10); // Between 4.2 and 4.9
            return { count: baseCount, rating: baseRating.toFixed(1) };
        }

        function generateLegacyReviews(id) {
            // Creates 3 fake reviews to show "Filled" state
            const legacyNames = ["Rohan Gupta", "Priya Sharma", "Amit K.", "Suresh Patel", "Neha Verma"];
            const legacyComments = [
                "Absolutely divine taste! Very authentic.",
                "Packaging was great, food was hot.",
                "Best prasadam in Pune. Must try.",
                "Pure satvik food, felt very light and energetic.",
                "Delivery was fast and food was fresh."
            ];
            let list = [];
            let sum = 0; for(let i=0; i<id.length; i++) sum += id.charCodeAt(i);
            
            for(let i=0; i<3; i++) {
                const nIdx = (sum + i) % legacyNames.length;
                const cIdx = (sum + i) % legacyComments.length;
                list.push({
                    userId: `legacy_${i}`,
                    userName: legacyNames[nIdx],
                    rating: 5 - (i%2),
                    comment: legacyComments[cIdx],
                    timestamp: Date.now() - (100000000 * (i+1)), // Past dates
                    isLegacy: true
                });
            }
            return list;
        }

        function renderMenu(list) {
            const b = document.getElementById('prod-box'); b.innerHTML = '';
            if(!list.length) { b.innerHTML = '<div class="center" style="padding:40px; color:#aaa; grid-column:1/-1;">No Dishes Found</div>'; return; }
            
            list.filter(x => x.active).forEach(p => {
                const c = CART.find(x => x.id == p.id);
                const q = c ? c.qty : 0;
                const hasStock = p.stock && p.stock > 0;
                let btn = '';
                if(hasStock) {
                    btn = q === 0 ? 
                        `<div class="add-btn" onclick="event.stopPropagation(); add('${p.id}')">ADD</div>` : 
                        `<div class="add-btn" onclick="event.stopPropagation();" style="background:white; color:var(--text-main); border:1px solid var(--success);"><div class="qty-box"><i class="fa-solid fa-minus" onclick="mod('${p.id}',-1)"></i> <span>${q}</span> <i class="fa-solid fa-plus" onclick="mod('${p.id}',1)"></i></div></div>`;
                }
                let unitBadge = p.unitType ? `<span class="unit-badge">${p.unitVal} ${p.unitType}</span>` : '';
                
                // Use Hybrid Stats for Display
                const legacy = getLegacyReviewData(p.id);

                b.innerHTML += `
                <div class="prod-card ${!hasStock ? 'out-of-stock' : ''}" onclick="openProduct('${p.id}')">
                    <div class="prod-info">
                        <div>
                            <div class="veg-tag"><div class="veg-dot"></div></div>
                            <div style="font-weight:700; margin-bottom:4px; line-height:1.3; font-size:1rem; color:#1E293B;">${escapeHtml(p.name)} ${unitBadge}</div>
                            <div class="rating-badge"><span>${legacy.rating}</span> <i class="fa-solid fa-star star-icon"></i><span style="font-weight:400; color:#94a3b8;">(${legacy.count}+)</span></div>
                            <div style="font-weight:800; font-size:0.95rem; margin-top:6px;">₹${p.price}</div>
                        </div>
                        <div style="font-size:0.75rem; color:#94A3B8; margin-top:5px;" class="line-clamp-2">${escapeHtml(p.description||p.category)}</div>
                    </div>
                    <div class="prod-img-wrapper">
                        <img src="${p.image}" class="prod-img">
                        ${!hasStock ? '<div class="sold-out-badge">SOLD OUT</div>' : ''}
                        ${btn}
                    </div>
                </div>`;
            });
            refreshCart();
        }

        window.openProduct = (id) => {
            const p = PRODS.find(x => x.id == id);
            if(!p) return;
            CURRENT_PROD = p;
            document.getElementById('pd-name').innerText = p.name;
            document.getElementById('pd-price').innerText = `₹${p.price}`;
            document.getElementById('pd-desc').innerText = p.description || "No description available.";
            const uBox = document.getElementById('pd-unit');
            if(p.unitType) { uBox.innerText = `${p.unitVal} ${p.unitType}`; uBox.style.display = 'inline-block'; } else { uBox.style.display = 'none'; }
            
            const gBox = document.getElementById('pd-gallery-box');
            let images = (p.gallery && p.gallery.length > 0) ? p.gallery : [p.image];
            gBox.innerHTML = images.map(img => `<img src="${img}" class="pd-slide">`).join('');
            
            const rBox = document.getElementById('related-box');
            rBox.innerHTML = "";
            const related = PRODS.filter(item => item.category === p.category && item.id !== p.id && item.active).slice(0, 6);
            if (related.length > 0) {
                 related.forEach(rel => {
                     rBox.innerHTML += `<div class="rel-card" onclick="openProduct('${rel.id}')"><img src="${rel.image}" class="rel-img"><div class="rel-name">${escapeHtml(rel.name)}</div><div class="rel-price">₹${rel.price}</div></div>`;
                 });
                 document.getElementById('related-section').classList.remove('hide');
            } else document.getElementById('related-section').classList.add('hide');

            const w = window.innerWidth;
            if(w >= 992) updateProductFooter('inline'); else updateProductFooter('mobile');

            // LOAD HYBRID REVIEWS
            loadReviews(p.id);

            nav('view-product');
        };

        // --- POWERFUL REVIEW LOGIC (HYBRID + EDIT FIX) ---
        function loadReviews(pid) {
            const list = document.getElementById('reviews-list-box');
            list.innerHTML = '<div class="center" style="padding:20px;"><i class="fa-solid fa-spinner fa-spin"></i></div>';
            
            onValue(ref(db, `reviews/${pid}`), (s) => {
                const realReviews = [];
                if(s.exists()) {
                    s.forEach(child => realReviews.push(child.val()));
                }

                // Generate Legacy Data
                const legacyStats = getLegacyReviewData(pid);
                const legacyReviews = generateLegacyReviews(pid);

                // Calculate Hybrid Average
                let realTotal = 0;
                realReviews.forEach(r => realTotal += parseInt(r.rating));
                
                // Formula: Weighted Average of Base + Real
                const baseW = 50; // Weight of legacy
                const baseR = parseFloat(legacyStats.rating);
                const realCount = realReviews.length;
                const finalAvg = ((baseR * baseW) + realTotal) / (baseW + realCount);
                const displayCount = parseInt(legacyStats.count) + realCount;

                // Update Display
                document.getElementById('pd-rating-val').innerText = finalAvg.toFixed(1);
                document.getElementById('pd-review-count').innerText = `${displayCount} Reviews`;

                // Update "Write Review" button text
                const btnTxt = document.getElementById('btn-write-rev-text');
                if(USER && realReviews.some(r => r.userId === USER.uid)) {
                    btnTxt.innerText = "Edit Review";
                } else {
                    btnTxt.innerText = "Write Review";
                }

                // Merge Lists for Display (Real on Top)
                // Sort Real: User's own first, then newest
                realReviews.sort((a,b) => {
                    if(USER && a.userId === USER.uid) return -1;
                    if(USER && b.userId === USER.uid) return 1;
                    return b.timestamp - a.timestamp;
                });

                const allReviews = [...realReviews, ...legacyReviews];

                list.innerHTML = '';
                allReviews.forEach(r => {
                    const stars = Array(5).fill(0).map((_,i) => `<i class="fa-${i < r.rating ? 'solid' : 'regular'} fa-star"></i>`).join('');
                    const date = new Date(r.timestamp).toLocaleDateString();
                    const isMe = USER && r.userId === USER.uid ? '(You)' : '';
                    const badge = !r.isLegacy ? `<span class="verified-badge"><i class="fa-solid fa-circle-check"></i> Verified</span>` : '';
                    const isVerifiedClass = !r.isLegacy ? 'verified-user' : '';

                    list.innerHTML += `
                    <div class="review-card ${isVerifiedClass}">
                        <div class="rc-top">
                            <div class="rc-user">
                                <div class="rc-avatar">${r.userName.charAt(0)}</div>
                                <div class="rc-meta">
                                    <div class="rc-name">${escapeHtml(r.userName)} ${isMe} ${badge}</div>
                                    <div class="rc-date">${date}</div>
                                </div>
                            </div>
                            <div class="rc-stars">${stars}</div>
                        </div>
                        <div class="rc-body">${escapeHtml(r.comment)}</div>
                    </div>`;
                });
                
                if(allReviews.length > 5) {
                    list.innerHTML += `<div style="text-align:center; margin-top:10px; color:#888; font-size:0.8rem;">Showing top reviews</div>`;
                }
            });
        }

        window.openReviewModal = () => {
            if(!USER || IS_GUEST) { toast("Please login to review"); openLoginModal(); return; }
            if(!CURRENT_PROD) return;

            // Check if user already reviewed
            get(ref(db, `reviews/${CURRENT_PROD.id}/${USER.uid}`)).then(s => {
                if(s.exists()) {
                    const r = s.val();
                    document.getElementById('rev-msg').value = r.comment;
                    const rInput = document.querySelector(`input[name="rate"][value="${r.rating}"]`);
                    if(rInput) rInput.checked = true;
                } else {
                    document.getElementById('rev-msg').value = '';
                    document.querySelectorAll('input[name="rate"]').forEach(x => x.checked = false);
                }
                document.getElementById('m-review').classList.add('open');
            });
        };

        window.submitReview = async () => {
            const ratingEl = document.querySelector('input[name="rate"]:checked');
            if(!ratingEl) return toast("Please select star rating");
            const rating = parseInt(ratingEl.value);
            const comment = document.getElementById('rev-msg').value.trim();
            if(comment.length < 3) return toast("Please write a short comment");

            // Capture Full Data
            const reviewData = {
                userId: USER.uid,
                userName: USER.displayName || document.getElementById('p-name').innerText || "Guest",
                userEmail: USER.email,
                userPhone: document.getElementById('p-phone').innerText || "",
                rating: rating,
                comment: comment,
                timestamp: serverTimestamp(),
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                isAdminAdded: false
            };

            // FIX: Using UPDATE to overwrite if exists, then force reload
            await update(ref(db, `reviews/${CURRENT_PROD.id}/${USER.uid}`), reviewData);
            
            toast("Review Submitted!");
            shutMod();
            
            // FORCE REFRESH TO SHOW NEW DATA IMMEDIATELY
            if(CURRENT_PROD) loadReviews(CURRENT_PROD.id);
        };
        // --- END HYBRID REVIEW SYSTEM ---

        function updateProductFooter(target='mobile') {
            if(!CURRENT_PROD) return;
            const p = CURRENT_PROD;
            const c = CART.find(x => x.id == p.id);
            const q = c ? c.qty : 0;
            let f;
            if (target === 'mobile') {
                f = document.getElementById('pd-action-box');
                f.style.display = 'flex'; 
                document.getElementById('pd-action-box-inline').innerHTML = ''; 
            } else {
                f = document.getElementById('pd-action-box-inline');
                document.getElementById('pd-action-box').style.display = 'none'; 
            }
            if(window.innerWidth >= 992) {
               f = document.getElementById('pd-action-box-inline');
               document.getElementById('pd-action-box').style.display = 'none';
            } else {
               f = document.getElementById('pd-action-box');
               f.style.display = 'flex';
               document.getElementById('pd-action-box-inline').innerHTML = '';
            }

            const hasStock = p.stock && p.stock > 0;
            if(!hasStock) { f.innerHTML = `<div style="text-align:center; width:100%; font-weight:800; color:var(--error); padding:10px;">TEMPORARILY SOLD OUT</div>`; return; }
            
            if(q === 0) {
                f.innerHTML = `${window.innerWidth < 992 ? `<div style="font-weight:700; font-size:1.1rem;">₹${p.price}</div>` : ''}<button class="btn btn-brand" style="width:${window.innerWidth >= 992 ? '100%' : '140px'}; padding:12px;" onclick="add('${p.id}'); updateProductFooter('${target}')">ADD TO PLATE</button>`;
            } else {
                f.innerHTML = `${window.innerWidth < 992 ? `<div style="font-weight:700; font-size:1.1rem;">₹${p.price * q}</div>` : ''}<div style="background:var(--brand); color:white; border-radius:12px; height:45px; width:${window.innerWidth >= 992 ? '100%' : '140px'}; display:flex; align-items:center; justify-content:space-between; padding:0 15px; font-weight:700;"><i class="fa-solid fa-minus" style="cursor:pointer;" onclick="mod('${p.id}',-1); updateProductFooter('${target}')"></i><span>${q}</span><i class="fa-solid fa-plus" style="cursor:pointer;" onclick="mod('${p.id}',1); updateProductFooter('${target}')"></i></div>`;
            }
        }
        
        window.addEventListener('resize', () => { if(CURRENT_PROD && !document.getElementById('view-product').classList.contains('hide')) updateProductFooter(); });

        window.add = (id) => { 
            const p = PRODS.find(x => x.id == id);
            if(p.stock && p.stock < 1) return toast("Sold Out"); 
            CART.push({...p, qty:1}); saveCart(); toast("Added to Plate"); 
        };
        
        window.mod = (id,d) => { 
            const i = CART.findIndex(x => x.id == id); 
            if(i > -1) {
                if (d > 0) {
                     const p = PRODS.find(x=>x.id==id);
                     if(p.stock && CART[i].qty >= p.stock) return toast(`Only ${p.stock} left in stock`);
                }
                CART[i].qty += d; if(CART[i].qty <= 0) CART.splice(i, 1); saveCart(); 
            } 
        };
        window.clearCart = () => { if(confirm('Clear entire plate?')) { CART=[]; COUPON=null; saveCart(); nav('view-home'); } };
        
        function saveCart() { 
            localStorage.setItem('gp_v8_cart', JSON.stringify(CART));
            if(COUPON) localStorage.setItem('gp_v8_coupon', JSON.stringify(COUPON)); else localStorage.removeItem('gp_v8_coupon');
            renderMenu(PRODS); 
            if(document.getElementById('view-product').style.display !== 'none' && CURRENT_PROD) updateProductFooter();
        }

        function refreshCart() {
            const count = CART.reduce((a,b) => a + b.qty, 0);
            const sub = CART.reduce((a,b) => a + (b.price * b.qty), 0);
            const bdg = document.getElementById('nav-badge');
            if(count>0) bdg.style.display = 'block'; else bdg.style.display='none';
            const fl = document.getElementById('float-bar');
            if(count > 0 && document.getElementById('view-home').style.display !== 'none' && window.innerWidth < 992) {
                fl.style.display = 'flex'; document.getElementById('fl-qty').innerText = `${count} Items`; document.getElementById('fl-total').innerText = `₹${sub}`;
            } else fl.style.display = 'none';

            if(CART.length === 0) {
                if(COUPON) { COUPON = null; localStorage.removeItem('gp_v8_coupon'); }
                document.getElementById('cart-empty').classList.remove('hide');
                document.getElementById('cart-content').classList.add('hide');
            } else {
                document.getElementById('cart-empty').classList.add('hide');
                document.getElementById('cart-content').classList.remove('hide');
                const lst = document.getElementById('cart-items'); lst.innerHTML = '';
                CART.forEach(i => {
                    const uStr = i.unitType ? `(${i.unitVal} ${i.unitType})` : '';
                    lst.innerHTML += `<div class="flex-between" style="background:#fff; border:1px solid #f0f0f0; padding:15px; border-radius:12px;"><div><div class="veg-tag" style="margin-bottom:4px; width:12px; height:12px;"><div class="veg-dot" style="width:6px; height:6px;"></div></div><div style="font-weight:700;">${escapeHtml(i.name)} <small>${uStr}</small></div><div style="font-size:0.85rem; color:#888;">₹${i.price}</div></div><div style="border:1px solid #ddd; border-radius:8px; height:32px; width:90px; display:flex; align-items:center; justify-content:space-between; padding:0 8px; font-weight:700;"><i class="fa-solid fa-minus" style="cursor:pointer; color:var(--text-light);" onclick="mod('${i.id}',-1)"></i><span>${i.qty}</span><i class="fa-solid fa-plus" style="cursor:pointer; color:var(--success);" onclick="mod('${i.id}',1)"></i></div></div>`;
                });
            }

            let disc = 0;
            const inputUI = document.getElementById('cp-input-ui'), appliedUI = document.getElementById('cp-applied-ui'), cpRes = document.getElementById('cp-res');
            if(COUPON) {
                const minO = COUPON.minOrder || 0, cat = (COUPON.category || 'all').toLowerCase(), type = COUPON.type || 'flat', val = COUPON.value || 0, code = COUPON.code || 'CODE';
                let eligibleAmount = (cat === 'all') ? sub : CART.reduce((sum, item) => ((item.category || '').toLowerCase() === cat ? sum + (item.price * item.qty) : sum), 0);
                if(sub < minO) { disc = 0; inputUI.classList.remove('hide'); appliedUI.classList.add('hide'); document.getElementById('cp-code').value = code; cpRes.innerText = `Add items worth ₹${minO - sub} more`; cpRes.style.color = "var(--brand)"; } 
                else if (eligibleAmount === 0 && cat !== 'all') { disc = 0; inputUI.classList.remove('hide'); appliedUI.classList.add('hide'); document.getElementById('cp-code').value = code; cpRes.innerText = `Valid on ${cat}`; cpRes.style.color = "var(--error)"; } 
                else {
                    disc = (type === 'flat') ? Math.min(val, eligibleAmount) : Math.round(eligibleAmount * (val/100));
                    inputUI.classList.add('hide'); appliedUI.classList.remove('hide'); document.getElementById('disp-cp-code').innerText = code; document.getElementById('disp-cp-desc').innerText = `You saved ₹${disc}`; cpRes.innerText = "Coupon Applied!"; cpRes.style.color = "var(--success)";
                }
            } else { inputUI.classList.remove('hide'); appliedUI.classList.add('hide'); cpRes.innerText = ""; }

            let finalDelivery = DELIVERY_FEE;
            const freeBar = document.getElementById('free-del-bar');
            if (sub >= MIN_FREE_DELIVERY) { finalDelivery = 0; freeBar.classList.remove('locked'); freeBar.innerHTML = `🎉 Great! Free Delivery Unlocked`; document.getElementById('b-del').innerHTML = `<span style="text-decoration:line-through; color:#aaa; margin-right:5px;">₹${DELIVERY_FEE}</span> <span style="color:var(--success)">FREE</span>`; } 
            else { const diff = MIN_FREE_DELIVERY - sub; freeBar.classList.add('locked'); freeBar.innerHTML = `<i class="fa-solid fa-truck"></i> Add items worth ₹${diff} for FREE Delivery`; document.getElementById('b-del').innerText = `₹${finalDelivery}`; }

            if (!COD_ENABLE) { document.getElementById('cod-opt-row').style.display = 'none'; if(document.querySelector('input[name="pay-mode"]:checked').value === 'cod') document.querySelector('input[name="pay-mode"][value="online"]').checked = true; } 
            else document.getElementById('cod-opt-row').style.display = 'flex';

            const payMode = document.querySelector('input[name="pay-mode"]:checked').value;
            let onlineDiscVal = 0;
            if (payMode === 'online' && ONLINE_DISC > 0) { onlineDiscVal = Math.round((sub - disc) * (ONLINE_DISC / 100)); document.getElementById('row-online-disc').style.display = 'flex'; document.getElementById('b-online-disc').innerText = `- ₹${onlineDiscVal}`; document.getElementById('online-offer-badge').style.display = 'inline-block'; document.getElementById('online-offer-badge').innerText = `${ONLINE_DISC}% OFF`; } 
            else { document.getElementById('row-online-disc').style.display = 'none'; document.getElementById('online-offer-badge').style.display = 'none'; }
            
            const minWarn = document.getElementById('min-order-msg'), placeBtn = document.getElementById('btn-place-order');
            if (sub < MIN_ORDER_VAL) { minWarn.style.display = 'block'; minWarn.innerText = `Minimum food order is ₹${MIN_ORDER_VAL}`; placeBtn.disabled = true; } else { minWarn.style.display = 'none'; placeBtn.disabled = false; }
            const total = Math.max(0, sub + finalDelivery - disc - onlineDiscVal);
            document.getElementById('b-item').innerText = '₹' + sub; document.getElementById('b-disc').innerText = '- ₹' + disc; document.getElementById('b-total').innerText = '₹' + total;
        }

        window.applyCp = () => {
            const c = val('cp-code').toUpperCase().trim();
            if(!c) return toast("Enter Code");
            document.getElementById('cp-res').innerText = "Checking...";
            get(ref(db, `coupons/${c}`)).then(s => {
                const v = s.val();
                if(v && v.active) { COUPON = { ...v, code: c }; document.getElementById('cp-code').value = ""; saveCart(); } 
                else { document.getElementById('cp-res').innerText = "Invalid Code"; document.getElementById('cp-res').style.color = "var(--error)"; }
            });
        };
        window.removeCp = () => { COUPON = null; saveCart(); toast("Coupon Removed"); };

        window.placeOrder = async () => {
            if(!STORE_OPEN) return toast("Kitchen is Closed");
            if(CART.length === 0) return toast("Plate is empty!");
            if(IS_GUEST || !USER) { openLoginModal(); toast("Login Required"); return; }
            const name = escapeHtml(val('final-name')), phone = escapeHtml(val('final-phone')), addr = escapeHtml(val('final-addr')), paymentMethod = document.querySelector('input[name="pay-mode"]:checked').value;
            if(name.length < 2 || !isValidPhone(phone) || addr.length < 5) return toast("Please check details");
            update(ref(db, `customers/${USER.uid}`), { name:name, phone:phone, address:addr });
            const sub = CART.reduce((a,b) => a + (b.price * b.qty), 0);
            let deliveryCharge = (sub >= MIN_FREE_DELIVERY) ? 0 : DELIVERY_FEE;
            let discVal = 0;
            if(COUPON) {
                 const minO = COUPON.minOrder || 0;
                 if (sub >= minO) {
                     const cat = (COUPON.category || 'all').toLowerCase();
                     let eligibleAmount = (cat === 'all') ? sub : CART.reduce((sum, item) => ((item.category||'').toLowerCase()===cat) ? sum+(item.price*item.qty) : sum, 0);
                     if(eligibleAmount > 0) discVal = (COUPON.type==='flat') ? Math.min(COUPON.value, eligibleAmount) : Math.round(eligibleAmount*(COUPON.value/100));
                 }
            }
            let onlineVal = 0; if (paymentMethod === 'online' && ONLINE_DISC > 0) onlineVal = Math.round((sub - discVal) * (ONLINE_DISC / 100));
            const tot = sub + deliveryCharge - discVal - onlineVal, finalDisc = discVal + onlineVal;

            if (paymentMethod === 'online') {
                const options = {
                    "key": "rzp_live_SG6aeuVkxXxv8c", "amount": tot * 100, "currency": "INR", "name": "Govinda's Prasadam", "description": "Order Payment", "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhKkhc5IkA65STmeUrIgSBI6nDpLrBG5GmZ1pzSkHZnSl5pTc1fzyHFmg1wqwDkeEaa0HZM6vcNk2WWTPuUpvhq-Uee_FUtPQwP2OUyAg8wzbJV1rk6_lCx1X0UlRuxpgulL3trFgzRAvgI1-aSRojJJWUMChXOl9yRSmsOLoHrdmOVDh8gVeUop5T3_VzU/s256/1000198120.png",
                    "handler": async function (response) {
                        await push(ref(db, 'orders'), { userId: USER.uid, userName: name, userPhone: phone, address: addr, items: CART, subTotal: sub, deliveryFee: deliveryCharge, discount: finalDisc, total: tot, status: 'placed', paymentMode: 'Online', paymentId: response.razorpay_payment_id, createdAt: serverTimestamp() });
                        CART = []; COUPON = null; saveCart(); nav('view-orders', document.querySelectorAll('.nav-btn')[2]); toast("Order Placed!");
                    }, "prefill": { "name": name, "email": USER.email, "contact": phone }, "theme": { "color": "#FF6D00" }
                };
                const rzp1 = new Razorpay(options); rzp1.on('payment.failed', function (response){ toast("Payment Failed: " + response.error.description); }); rzp1.open();
            } else {
                await push(ref(db, 'orders'), { userId: USER.uid, userName: name, userPhone: phone, address: addr, items: CART, subTotal: sub, deliveryFee: deliveryCharge, discount: finalDisc, total: tot, status: 'placed', paymentMode: 'COD', createdAt: serverTimestamp() });
                CART = []; COUPON = null; saveCart(); nav('view-orders', document.querySelectorAll('.nav-btn')[2]); toast("Order Placed!");
            }
        };

        setInterval(() => {
            const timers = document.querySelectorAll('.countdown-timer');
            timers.forEach(t => {
                const target = parseInt(t.getAttribute('data-target'));
                const diff = target - Date.now();
                const oid = t.getAttribute('data-id');
                if (diff <= 0) {
                    t.innerText = "Order Confirmed"; t.style.color = "#2E7D32";
                    const btn = document.getElementById(`cancel-btn-${oid}`); if(btn) btn.style.display = 'none';
                    const row = document.getElementById(`confirm-row-${oid}`); if(row) row.style.display = 'none';
                } else {
                    const m = Math.floor(diff / 60000), s = Math.floor((diff % 60000) / 1000);
                    t.innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
                }
            });
        }, 1000);

        window.manualConfirm = async (oid) => { await update(ref(db, `orders/${oid}`), { status: 'confirmed', userConfirmed: true, confirmedAt: serverTimestamp() }); toast("Confirmed!"); if(document.getElementById('m-bill').classList.contains('open')) openBill(oid); };
        
        window.cancelOrder = async (oid, time) => {
            if (Date.now() - time > 180000) return toast("Time limit exceeded");
            if(!confirm('Cancel Order?')) return;
            const s = await get(ref(db, `orders/${oid}`)); const o = s.val();
            if(o.status !== 'placed' && o.status !== 'paid') return toast("Cannot cancel");
            if(o.userConfirmed) return toast("Already Confirmed");
            await update(ref(db, `orders/${oid}`), { status: 'cancelled', cancelledAt: serverTimestamp() });
            shutMod(); toast("Order Cancelled");
        };

        function renderHistory(data) {
            const lst = document.getElementById('orders-list'); lst.innerHTML = '';
            if(!data) { lst.innerHTML = '<div class="center" style="margin-top:50px; color:#aaa;">No past orders</div>'; return; }
            Object.entries(data).map(([k,v]) => ({id:k, ...v})).filter(x => x.userId === USER.uid).sort((a,b) => b.createdAt - a.createdAt).forEach(o => {
                const st = o.status;
                let track = '';
                if(st === 'out_for_delivery') track = `<div class="track-box"><div class="flex-between"><b style="color:#1B5E20; display:flex; align-items:center; gap:6px;"><i class="fa-solid fa-person-biking"></i> Order on Way</b>${o.trackingUrl ? `<a href="${o.trackingUrl}" target="_blank" class="live-btn">TRACK</a>` : '<span style="font-size:0.7rem;">Arriving Soon</span>'}</div></div>`;
                let timer = '';
                const target = o.createdAt + 180000;
                if (st === 'placed' && !o.userConfirmed && Date.now() < target) {
                    timer = `<div class="timer-strip" id="confirm-row-${o.id}"><div class="timer-val"><i class="fa-regular fa-clock"></i> <span class="countdown-timer" data-id="${o.id}" data-target="${target}">03:00</span></div><button class="confirm-btn-sm" onclick="event.stopPropagation(); manualConfirm('${o.id}')">CONFIRM NOW</button></div>`;
                }
                lst.innerHTML += `<div class="order-card st-${st}" onclick="openBill('${o.id}')"><div class="flex-between" style="margin-bottom:10px; border-bottom:1px dashed #eee; padding-bottom:10px;"><div style="display:flex; gap:10px; align-items:center;"><div style="background:#f0f0f0; width:35px; height:35px; border-radius:8px; display:grid; place-items:center;"><i class="fa-solid fa-box"></i></div><div><div style="font-weight:700;">#${o.id.slice(-5).toUpperCase()}</div><div style="font-size:0.75rem; color:#888;">${new Date(o.createdAt).toLocaleString()}</div></div></div><span style="font-size:0.75rem; font-weight:700; text-transform:uppercase; padding:4px 8px; border-radius:5px;" class="st-${st}">${st.replace('_',' ')}</span></div><div style="font-size:0.85rem; color:#555;">${o.items.map(i => `${i.qty} x ${escapeHtml(i.name)}`).join(', ')}</div>${timer}${track}<div class="flex-between" style="margin-top:10px;"><div style="font-weight:800; font-size:1.1rem;">₹${o.total}</div><div style="font-size:0.8rem; font-weight:700; color:var(--brand);">Details <i class="fa-solid fa-chevron-right"></i></div></div></div>`;
            });
        }

        window.openBill = async (oid) => {
            const s = await get(ref(db, `orders/${oid}`)); const o = s.val();
            const b = document.getElementById('bill-content');
            let actionBtn = '';
            const target = o.createdAt + 180000;
            const canCancel = (o.status === 'placed' || o.status === 'paid') && !o.userConfirmed && (Date.now() < target);
            if (canCancel) {
                actionBtn = `<div style="margin-top:20px; border-top:1px solid #eee; padding-top:15px;" id="cancel-box-${o.id}"><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; background:#FEF2F2; padding:10px; border-radius:8px;"><span style="color:#DC2626; font-weight:700;" class="countdown-timer" data-id="${o.id}" data-target="${target}">03:00</span><button class="confirm-btn-sm" onclick="manualConfirm('${o.id}')">CONFIRM INSTANTLY</button></div><button class="btn" id="cancel-btn-${o.id}" style="background:#fff; border:1px solid #FFEBEE; color:#D32F2F; width:100%; font-weight:700;" onclick="cancelOrder('${oid}', ${o.createdAt})">CANCEL ORDER</button></div>`;
            } else if (o.status === 'cancelled') actionBtn = `<div style="margin-top:20px; text-align:center; color:#D32F2F; font-weight:800;">CANCELLED</div>`;
            else actionBtn = `<div style="margin-top:20px; text-align:center; color:#2E7D32; font-weight:700; background:#E8F5E9; padding:10px;">ORDER CONFIRMED</div>`;

            b.innerHTML = `<div class="flex-between" style="margin-bottom:20px;"><h3 style="margin:0;">Receipt</h3><div class="center" style="width:30px; height:30px; background:#f5f5f5; border-radius:50%; cursor:pointer;" onclick="shutMod()"><i class="fa-solid fa-xmark"></i></div></div><div style="text-align:center; margin-bottom:20px;"><div style="font-weight:800; color:var(--brand); font-size:1.2rem;">Govinda's Prasadam</div><div style="font-size:0.85rem;">ISKCON Hadapsar</div><div style="margin-top:5px; font-weight:700;">${o.paymentMode}</div><div style="font-size:0.75rem; color:#666;">ID: ${oid}</div></div><div style="border-top:2px dashed #eee; padding-top:15px;">${o.items.map(i => `<div class="flex-between" style="font-size:0.9rem; margin-bottom:10px;"><span>${i.qty} x ${escapeHtml(i.name)}</span><span style="font-weight:600;">₹${i.price*i.qty}</span></div>`).join('')}</div><div style="border-top:1px solid #eee; margin-top:10px; padding-top:10px;"><div class="flex-between" style="font-size:0.9rem;"><span>Subtotal</span><span>₹${o.subTotal}</span></div><div class="flex-between" style="font-size:0.9rem; color:var(--success);"><span>Discount</span><span>- ₹${o.discount}</span></div><div class="flex-between" style="font-size:0.9rem;"><span>Delivery</span><span>₹${o.deliveryFee}</span></div><div class="flex-between" style="font-weight:800; font-size:1.2rem; margin-top:15px;"><span>Paid Total</span><span>₹${o.total}</span></div></div>${actionBtn}`;
            document.getElementById('m-bill').classList.add('open');
        };

        window.nav = (p, el, add=true) => {
            if(add) history.pushState({view:p}, null, "");
            document.querySelectorAll('.view').forEach(v => v.classList.add('hide'));
            document.getElementById(p).classList.remove('hide');
            const h = document.getElementById('header-main'), f = document.getElementById('float-bar');
            if(p === 'view-home') { h.style.display = 'flex'; refreshCart(); } 
            else if (window.innerWidth >= 992) h.style.display = 'flex'; else h.style.display = 'none';
            if(p !== 'view-home') f.style.display = 'none';
            const nb = document.getElementById('navbar');
            if(p === 'view-product' && window.innerWidth < 992) nb.classList.add('hide'); else nb.classList.remove('hide');
            if(el) { document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); }
            window.scrollTo(0,0);
        };

        window.addEventListener('popstate', (e) => { if(e.state && e.state.view) nav(e.state.view, null, false); else { history.pushState(null,null,location.href); document.getElementById('m-exit').classList.add('open'); }});
        window.closeExitModal = () => document.getElementById('m-exit').classList.remove('open');
        window.confirmExit = () => { history.back(); history.back(); window.location.href="about:blank"; };
        window.findLoc = () => navigator.geolocation.getCurrentPosition(p => { const s = `GPS: ${p.coords.latitude.toFixed(4)}, ${p.coords.longitude.toFixed(4)}`; document.getElementById('disp-addr').innerText = "Current Location"; document.getElementById('final-addr').value = s; document.getElementById('e-addr').value = s; toast("Location Updated"); });
        window.filt = (c,el) => { document.querySelectorAll('.cat-item').forEach(x => x.classList.remove('active')); el.classList.add('active'); c === 'all' ? renderMenu(PRODS) : renderMenu(PRODS.filter(x => x.category === c)); };
        window.shutMod = () => document.querySelectorAll('.modal').forEach(m => m.classList.remove('open'));
        window.openEdit = () => { if(IS_GUEST) { toast("Login required"); return; } document.getElementById('m-edit').classList.add('open'); };
        window.saveProfile = () => { const n = escapeHtml(val('e-name')), p = val('e-phone'), a = escapeHtml(val('e-addr')); if(!isValidPhone(p)) return toast("Invalid Phone"); update(ref(db, `customers/${USER.uid}`), {name:n, phone:p, address:a}); toast("Profile Updated"); shutMod(); };
        window.onclick = function(event) { if (event.target.classList.contains('modal')) shutMod(); };
        function val(id){ return document.getElementById(id).value; }
        function err(m){ document.getElementById('auth-msg').innerText = m.replace('Firebase:',''); }
        function toast(m){ document.getElementById('toast-msg').innerText=m; const t = document.getElementById('toast'); t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 3000); }
    </script>
</body>
</html>